
<div class="order-page">
    <div class="main-wrap">
        <div class="subwrap1">
            <div class="wrap-item item1">
                <div class="carousel carousel-main">
                    <div class="carousel-cell" style="background-image: url('/images/ex1 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex 2 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex3 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex4 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex5 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex6 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex7 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex8 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex9 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex10 cut.jpg')"></div>
                </div>
            </div>
            <div class="wrap-item item2">
                <div class="carousel carousel-nav">
                    <div class="carousel-cell" style="background-image: url('/images/ex1 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex 2 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex3 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex4 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex5 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex6 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex7 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex8 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex9 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex10 cut.jpg')"></div>
                </div>
            </div>
        </div>
        <!-- <img src="priceff.png"> -->
        <div class="subwrap2">
            <div class="wrap-item item3">
                <div class="description-of-sale">
                    <div class="title">Original Dream Portrait Art</div>
                    <div class="order-page-rating">
                        <img class="star-rating" src="/images/filled_star.png" alt="">
                        <img class="star-rating" src="/images/filled_star.png" alt="">
                        <img class="star-rating" src="/images/filled_star.png" alt="">
                        <img class="star-rating" src="/images/filled_star.png" alt="">
                        <img class="star-rating" src="/images/filled_star.png" alt="">
                        <span class="reviews-qty">{{ reviewsCount }} reviews</span>
                    </div>
                    {{#if hasReviews}}
                        <div style="display: flex; margin: 10px 0">
                            <div>
                                {{#each averageRating}}
                                    {{# if this }}
                                        <img class="star-rating"
                                             src="/images/filled_star.png"
                                             alt="">
                                    {{else}}
                                        <img class="star-rating"
                                             src="/images/empty_star.png"
                                             alt="">
                                    {{/ if }}
                                {{/each}}
                            </div>
                            <div class="reviews-qty">20{{ reviewsAmount }}
                                reviews
                            </div>
                            <!--                    <img style="max-height: 23px" src="/images/stars.png">-->
                        </div>
                    {{/if}}
                    <div class="total-price" id="total-price-page-static">
                        <del>$58</del><b class="text-danger">$29</b>
                    </div>
                </div>
            </div>
            <div class="wrap-item item4">
                <div class="order-form">
                    <div class="title text-center mb-2">PLACE YOUR ORDER IN 4 STEPS</div>
                    <div class="number-of-people-block">
                        <div class="sub-title mb-2"><b class="pr-2">1</b>Choose number of people & pets</div>
                        <div style="display: flex; justify-content: space-between;">
                            <button data-price="29" data-id="1" class="people-amount-image people-amount-image-clicked">1</button>
                            <button data-price="49" data-id="2" class="people-amount-image">2</button>
                            <button data-price="69" data-id="3" class="people-amount-image">3</button>
                            <button data-price="89" data-id="4" class="people-amount-image">4</button>
                            <button data-price="109" data-id="5" class="people-amount-image">5</button>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <button data-price="129" data-id="6" class="people-amount-image">6</button>
                            <button data-price="149" data-id="7" class="people-amount-image">7</button>
                            <button data-price="169" data-id="8" class="people-amount-image">8</button>
                            <button data-price="189" data-id="9" class="people-amount-image">9</button>
                            <button data-price="209" data-id="10" class="people-amount-image">10</button>
                        </div>
                        <small class="form-text text-danger error-message">required</small>
                    </div>

                    <div class="background-image-block mt-3">
                        <div class="sub-title mb-2"><b class="pr-2">2</b>Choose Background</div>
                        <div class="carousel background-carousel-main my-2">
                            <div class="carousel-cell" id="castle" style="background-image: url('/images/12x18 H castle.jpg')"></div>
                            <div class="carousel-cell" id="beach" style="background-image: url('/images/18x12 H beach.jpg')"></div>
                            <div class="carousel-cell" id="hearts" style="background-image: url('/images/12x18 H hearts.jpg')"></div>
                            <div class="carousel-cell" id="staryNight" style="background-image: url('/images/12x18 H starry night.jpg')"></div>
                            <div class="carousel-cell" id="bokeh" style="background-image: url('/images/12x18 bokeh.jpg')"></div>
                            <div class="carousel-cell" id="custom">+25$</div>
                        </div>
                        <div class="carousel background-carousel-nav my-2">
                            <div class="carousel-cell is-nav-selected" data-price="0" data-id="14" data-name="Castle" style="background-image: url('/images/12x18 H castle.jpg')"></div>
                            <div class="carousel-cell" data-price="0" data-id="12" data-name="Beach" style="background-image: url('/images/18x12 H beach.jpg')"></div>
                            <div class="carousel-cell" data-price="0" data-id="13" data-name="Hearts" style="background-image: url('/images/12x18 H hearts.jpg')"></div>
                            <div class="carousel-cell" data-price="0" data-id="11" data-name="Starry Night" style="background-image: url('/images/12x18 H starry night.jpg')"></div>
                            <div class="carousel-cell" data-price="0" data-id="15" data-name="Bokeh" style="background-image: url('/images/12x18 bokeh.jpg')"></div>
                            <div class="carousel-cell" data-price="25" data-id="111" data-name="Custom" style="background-image: url('/images/custom.png')"></div>
                        </div>
                        <small class="form-text text-danger error-message">required</small>
                    </div>

                    <div class="notes-block mt-3">
                        <div class="sub-title mb-2"><b class="pr-2">3</b>Add notes (eye color, particular accessories, details, special text)</div>
                        <textarea id="text-in" class="form-control mt-3" maxlength="500" rows="4"></textarea>
                    </div>

                    <div class="photo-block mt-3">
                        <div class="sub-title mb-2"><b class="pr-2">4</b>Upload your photo</div>
                        <div class="mt-3">
                            <input id="upload-image" type="file" class="filepond" name="filepond">
                            <input type="text" class="filepond" name="image-url" hidden>
                        </div>
                        <small class="form-text text-danger error-message">required</small>
                    </div>

                    <div class="total-price text-center mt-3">
                        <del>$48</del><b class="text-danger">$29</b>
                    </div>

                    <div class="text-center mt-3">
                        <button class="full-btn" id="add-to-cart"><span>ADD TO CART</span></button>
                    </div>

                    <div class="text-center mt-3 font-size-1 text-uppercase font-weight-bold">
                        <b class="text-danger">{{ spots }}</b> spots left at this price
                    </div>
                </div>
            </div>

            <div class="wrap-item item4">
                <div class="counter">
                    <img src="/images/eye.png">
                    <div class="text">
                        <b id="demo">17</b>
                        People are currently looking at this product
                    </div>
                </div>
                <div class="deliver">
                    <img src="/images/airport.png">
                    <div class="text"> Estimated delivery time 3-5 days</div>
                </div>
            </div>

            <div class="wrap-item item9 info-section">
                <h5 class="info-section-title title text-center mb-3">TURN YOUR PHOTO INTO A CARTOON!</h5>
                <p class="px-2 text-center font-size-08">
                    It's Simple! Just customize your
                    package using the buttons above, upload
                    your photo, leave us a note and leave the rest
                    to us!
                </p>
                <p class="px-2 text-center font-size-1 text-uppercase font-weight-bold">
                    JUST THINK OF THE
                    REACTION YOUR FRIENDS OR
                    FAMILY WOULD HAVE!
                </p>
                <div class="info-section-image">
                    <img src="/images/info_section_1.jpg">
                </div>
                <p class="px-2 text-center">
                    Each design is <b>100% hand-draw</b> by a real
                    artist using a digital tablet. No gimmick or
                    special effects - <b>just skilled artistry that will
                    capture every detail.</b>
                </p>
                <p class="px-2 mt-3 text-center">
                    You will receive a <b>downloadable JPEG file</b> that
                    can be used <b>digitally</b> or for <b>high-quality print.</b>
                </p>
                <div class="info-section-image">
                    <img src="/images/info_section_2.jpg">
                </div>
                <p class="px-2 text-center text-uppercase">
                    Don't know if you will like it? Don't worry!
                    We offer free unlimited revisions! We will
                    work together until you are 100% happy with
                    the final result.
                </p>
                <p class="px-2 mt-3 font-weight-bold text-center text-uppercase font-size-125">
                    What are you waiting for!!!
                </p>
            </div>
        </div>
    </div>

    <div class="reviewsContent">
        <h2 class="title-hellofreeday text-center">HAPPY CUSTOMERS</h2>
        <div class="rating-sum my-2 d-flex justify-content-center align-items-center">
            <img class="star-rating" src="/images/filled_star.png" alt="">
            <img class="star-rating" src="/images/filled_star.png" alt="">
            <img class="star-rating" src="/images/filled_star.png" alt="">
            <img class="star-rating" src="/images/filled_star.png" alt="">
            <img class="star-rating" src="/images/filled_star.png" alt="">
            <span class="reviews-qty">{{ reviewsCount }} reviews</span>
        </div>
        <div class="reviews">
            <div class="reviewsAdmin">
                {{> reviews_block }}
            </div>
        </div>
    </div>
</div>
<script>
    initFilePond()
    initFlickityCarousel()

    function initFilePond () {
        FilePond.registerPlugin(FilePondPluginFileValidateType);
        FilePond.registerPlugin(FilePondPluginImagePreview);
        FilePond.registerPlugin(FilePondPluginFileValidateSize);
        FilePond.create(
                document.querySelector('#upload-image'),
                {
                    acceptedFileTypes: ['image/*'],
                    maxFileSize: '10MB',
                    credits: false,
                    labelIdle: '<span class="filepond--label-action">Upload Photo</span>',
                    server: {
                        process: function (fieldName, file, metadata, load, error, progress, abort) {
                            // upload image to s3
                            s3.upload({
                                Key: `photos/${Date.now()}_${file.name}`,
                                Body: file,
                                ContentType: file.type,
                                ContentDisposition: 'attachment',
                                ACL: 'public-read'
                            }, function(err, data) {
                                if (err) return error('Something went wrong')

                                $('input[name=image-url]').val(data.Location)

                                load(data.Key);
                            });
                        }
                    }
                }
        );
    }

    function initFlickityCarousel () {
        $('.carousel-main').flickity({ pageDots: false })
        $('.carousel-nav').flickity({
            asNavFor: '.carousel-main',
            contain: true,
            pageDots: false,
            prevNextButtons: false
        })

        $('.background-carousel-main').flickity({
            pageDots: false,
            prevNextButtons: false
        })
        $('.background-carousel-nav').flickity({
            asNavFor: '.background-carousel-main',
            contain: true,
            pageDots: false,
            prevNextButtons: false,
            groupCells: true
        })
    }

    // dynamic counter
    var x = 0;

    setInterval(function () {
        var x = Math.floor((Math.random() * 7) + 15);
        document.getElementById("demo").innerHTML = x;
    }, 6000);
    // =============================

    // order data variables
    var selectedPeopleAmount = getSelectedPeopleData();
    var selectedBakcground = getBackgroundData();
    var wishesText = null;
    // order data variables


    var addToCart = document.getElementById('add-to-cart');
    var textIn = document.getElementById('text-in');

    addToCart.addEventListener('click', function (event) {
        // validations
        if (!selectedPeopleAmount || !selectedBakcground || !getImageURL()) {
            $('.number-of-people-block .error-message').toggle(!selectedPeopleAmount)
            $('.background-image-block .error-message').toggle(!selectedBakcground)
            $('.photo-block .error-message').toggle(!getImageURL())
            return false
        }

        var localStorageCart = JSON.parse(localStorage.getItem("cart"));

        if (localStorageCart == null) {
            localStorageCart = [];
        }

        localStorageCart.push({
            selectedPeople: selectedPeopleAmount,
            selectedBakcground: selectedBakcground,
            wishesText: wishesText,
            imageUrl: getImageURL()
        });

        localStorage.setItem("cart", JSON.stringify(localStorageCart));
        updateCartQty();
        if (localStorageCart.length > 0) {
            window.location.href = '/cart-page';
        }
    });

    function getImageURL () {
      return $('input[name=image-url]').val()
    }

    function getBackgroundData () {
      return $('.background-carousel-nav .is-nav-selected').data()
    }

    function getSelectedPeopleData () {
      return $('.number-of-people-block .people-amount-image-clicked').data()
    }


    $('.background-carousel-main').on('change.flickity', e => {
        selectedBakcground = getBackgroundData()
        priceForAll()
    })


    var peopleAmountImages = document.getElementsByClassName("people-amount-image");

    for (var i = 0; i < peopleAmountImages.length; i++) {
        peopleAmountImages[i].addEventListener('click', function (event) {

            for (var j = 0; j < peopleAmountImages.length; j++) {
                peopleAmountImages[j].className = "people-amount-image";
            }

            var price = Number(event.target.getAttribute('data-price'));
            var id = event.target.getAttribute('data-id');

            event.target.className += " people-amount-image-clicked";

            selectedPeopleAmount = {
                id: id,
                price: price
            };
            priceForAll();
        });
    }


    var priceForAll = () => {
        var peoplePricePage = selectedPeopleAmount ? selectedPeopleAmount.price : 0;
        var backgroundPricePage = selectedBakcground ? selectedBakcground.price : 0;

        var totalPricePage = peoplePricePage + backgroundPricePage;

        if (selectedPeopleAmount.price != null) {
            $('.total-price').html(`<del>$${totalPricePage * 2}</del><b class="text-danger">$${totalPricePage}</b>`)
        }
    }


    function showCartElement() {
        var localStorageCart = JSON.parse(localStorage.getItem("cart"));
        var totalPrice = 0;

        if (!localStorageCart) {
            return;
        }

        var shoppingCart = document.getElementById('cart');
        shoppingCart.innerHTML = '';

        for (var i = 0; i < localStorageCart.length; i++) {
            var item = localStorageCart[i];
            totalPrice += item.selectedPeople.price + item.selectedBakcground.price;
            // if (item.selectedBakcground != null) {
            //     totalPrice += item.selectedBakcground.price;
            // }
            // if (item.image != null) {
            shoppingCart.innerHTML +=
                    "<li>People: " + item.selectedPeople.id + " - $" + item.selectedPeople.price +
                    " : " + item.selectedBakcground.name + " - $" + item.selectedBakcground.price + "</li>";
            // } else {
            //     shoppingCart.innerHTML +=
            //         "<li>People: " + item.selectedPeople.id + " - $" + item.selectedPeople.price + "</li>";
            // }
        }

        var totalPriceElement = document.getElementById('total-price');
        totalPriceElement.innerHTML = 'Total Price : $' + totalPrice;
    }


    textIn.addEventListener('input', function (event) {
        wishesText = event.target.value;
    });
</script>
